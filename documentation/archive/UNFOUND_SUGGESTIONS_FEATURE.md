# Функция автоподсказок для ненайденного оборудования

## Описание

Добавлена система интеллектуальных подсказок при добавлении информации о ненайденном оборудовании. Система автоматически предлагает варианты на основе данных из базы данных.

## Функциональность

### 1. Подсказки для ФИО сотрудника
- Автоматический поиск совпадений при вводе 2+ символов
- Сортировка: сначала имена, начинающиеся с введенного текста
- Кнопки для быстрого выбора
- Возможность ввести вручную
- Кнопка "Обновить список"

### 2. Подсказки для типа оборудования
- **Автоматическая загрузка из БД** - типы берутся из таблицы CI_TYPES
- Показываются первые 15 типов из базы данных
- Fallback на предустановленный список при ошибке:
  - Системный блок
  - Монитор
  - МФУ
  - ИБП
  - Ноутбук
  - Принтер
  - Сканер
  - Клавиатура
  - Мышь
  - Телефон
- Возможность ввести вручную

### 3. Подсказки для модели оборудования
- Автоматический поиск моделей из БД при вводе 2+ символов
- Сортировка по релевантности
- Кнопки для быстрого выбора
- Возможность ввести как есть

### 4. Подсказки для локации
- Автоматический поиск локаций из таблицы LOCATIONS
- Fallback на LOC_NO из ITEMS при отсутствии доступа
- Сортировка по релевантности
- Возможность ввести как есть

### 5. Выбор статуса через кнопки
- Предустановленные статусы:
  - В работе
  - На складе
  - В ремонте
  - Списано
  - Резерв
  - Новое
- Только выбор из списка (без ручного ввода)
- Возможность пропустить

### 6. Выбор филиала через кнопки
- Список всех филиалов из таблицы BRANCHES
- Кнопки для быстрого выбора
- Возможность пропустить

## Технические детали

### Файлы

**bot/handlers/suggestions_handler.py**
- `show_employee_suggestions()` - показ подсказок ФИО
- `show_equipment_type_suggestions()` - показ типов оборудования
- `show_model_suggestions()` - показ подсказок моделей
- `show_location_suggestions()` - показ подсказок локаций
- `show_status_suggestions()` - показ статусов
- `show_branch_suggestions()` - показ филиалов

**bot/services/suggestions.py**
- `get_employee_suggestions()` - получение подсказок ФИО из БД
- `get_equipment_type_suggestions()` - получение типов оборудования из БД
- `get_model_suggestions()` - получение подсказок моделей из БД
- `get_location_suggestions()` - получение подсказок локаций из БД
- `get_branch_suggestions()` - получение списка филиалов из БД

**bot/handlers/unfound.py**
- `handle_unfound_type_suggestion()` - обработка выбора типа
- `handle_unfound_model_suggestion()` - обработка выбора модели
- `handle_unfound_location_suggestion()` - обработка выбора локации
- `handle_unfound_status_suggestion()` - обработка выбора статуса
- `handle_unfound_branch_suggestion()` - обработка выбора филиала

### Callback Data Patterns

```
unfound_emp:{idx}       - выбор сотрудника
unfound_emp:manual      - ввести ФИО вручную
unfound_emp:refresh     - обновить список

unfound_type:{idx}      - выбор типа оборудования
unfound_type:manual     - ввести тип вручную

unfound_model:{idx}     - выбор модели
unfound_model:manual    - ввести модель как есть

unfound_loc:{idx}       - выбор локации
unfound_loc:manual      - ввести локацию как есть

unfound_status:{idx}    - выбор статуса
skip_status             - пропустить статус

unfound_branch:{idx}    - выбор филиала
skip_branch             - пропустить филиал
```

### Хранение данных в context.user_data

```python
# Временные данные для подсказок
'pending_unfound_employee_input'  # Введенное ФИО
'unfound_employee_suggestions'    # Список подсказок ФИО

'unfound_type_shown'              # Флаг показа типов
'unfound_type_suggestions'        # Список типов

'pending_unfound_model_input'     # Введенная модель
'unfound_model_suggestions'       # Список подсказок моделей

'pending_unfound_location_input'  # Введенная локация
'unfound_location_suggestions'    # Список подсказок локаций

'unfound_status_suggestions'      # Список статусов
'unfound_branch_suggestions'      # Список филиалов

'unfound_branch_shown'            # Флаг показа филиалов

# Финальные данные
'unfound_employee'                # Выбранный сотрудник
'unfound_type'                    # Выбранный тип
'unfound_model'                   # Выбранная модель
'unfound_location'                # Выбранная локация
'unfound_status'                  # Выбранный статус
'unfound_branch'                  # Выбранный филиал
```

## Пользовательский опыт

### Сценарий 1: Выбор из подсказок
1. Пользователь вводит "Иван"
2. Бот показывает список совпадений с кнопками
3. Пользователь нажимает на нужное ФИО
4. Переход к следующему шагу

### Сценарий 2: Ручной ввод
1. Пользователь вводит "Иванов Иван"
2. Бот показывает подсказки
3. Пользователь нажимает "Ввести как есть"
4. Значение сохраняется, переход к следующему шагу

### Сценарий 3: Выбор типа оборудования
1. При входе в шаг автоматически показываются кнопки с типами
2. Пользователь выбирает нужный тип
3. Переход к следующему шагу

### Сценарий 4: Выбор статуса
1. Автоматически показываются кнопки со статусами
2. Пользователь выбирает статус или пропускает
3. Переход к следующему шагу

## Преимущества

1. **Скорость ввода** - меньше печатать, больше кликать
2. **Точность данных** - меньше опечаток
3. **Консистентность** - единообразие данных
4. **UX** - интуитивно понятный интерфейс
5. **Валидация** - автоматическая проверка данных

## Ограничения

- Подсказки показываются только при вводе 2+ символов
- Максимум 8 подсказок в списке
- Статус можно выбрать только из предустановленного списка
- Филиал можно выбрать только из списка БД

## Будущие улучшения

- [ ] Добавить кэширование подсказок
- [ ] Добавить fuzzy search для лучшего поиска
- [ ] Добавить возможность добавления новых типов оборудования
- [ ] Добавить возможность добавления новых статусов
- [ ] Добавить историю последних выборов пользователя
