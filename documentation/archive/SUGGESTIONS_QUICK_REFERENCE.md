# Быстрая справка: Автоподсказки

## Как работают подсказки для каждого поля

### 1. ФИО Сотрудника
**Тип:** Подсказки при вводе  
**Минимум символов:** 2  
**Источник:** БД (ITEMS.EMPLOYEE_NAME + OWNERS.OWNER_DISPLAY_NAME)

```
Пользователь вводит: "Иван"
    ↓
Показываются кнопки с совпадениями
    ↓
Пользователь выбирает или нажимает "Ввести как есть"
```

### 2. Тип Оборудования
**Тип:** Подсказки при вводе  
**Минимум символов:** 2  
**Источник:** БД (CI_TYPES.TYPE_NAME)

```
Пользователь вводит: "МФУ"
    ↓
Показываются кнопки с совпадениями
    ↓
Пользователь выбирает или нажимает "Ввести как есть"
```

### 3. Модель Оборудования
**Тип:** Подсказки при вводе  
**Минимум символов:** 2  
**Источник:** БД (CI_MODELS.MODEL_NAME)

```
Пользователь вводит: "Dell"
    ↓
Показываются кнопки с совпадениями
    ↓
Пользователь выбирает или нажимает "Ввести как есть"
```

### 4. Описание
**Тип:** Свободный ввод  
**Подсказки:** Нет  
**Можно пропустить:** Да (/skip)

### 5. Инвентарный номер
**Тип:** Свободный ввод  
**Подсказки:** Нет  
**Можно пропустить:** Да (/skip)

### 6. IP-адрес
**Тип:** Свободный ввод  
**Подсказки:** Нет  
**Можно пропустить:** Да (/skip)

### 7. Филиал
**Тип:** Автоматические кнопки  
**Минимум символов:** -  
**Источник:** БД (BRANCHES.BRANCH_NAME)

```
Переход в состояние
    ↓
Автоматически показываются кнопки с филиалами
    ↓
Пользователь выбирает или нажимает "Пропустить"
```

### 8. Локация
**Тип:** Подсказки при вводе  
**Минимум символов:** 2  
**Источник:** БД (LOCATIONS.DESCR или ITEMS.LOC_NO)

```
Пользователь вводит: "Офис"
    ↓
Показываются кнопки с совпадениями
    ↓
Пользователь выбирает или нажимает "Ввести как есть"
```

### 9. Статус
**Тип:** Автоматические кнопки  
**Минимум символов:** -  
**Источник:** Предустановленный список

```
Переход в состояние
    ↓
Автоматически показываются кнопки со статусами
    ↓
Пользователь выбирает или нажимает "Пропустить"
```

**Статусы:**
- В работе
- На складе
- В ремонте
- Списано
- Резерв
- Новое

## Логика работы

### Подсказки при вводе (ФИО, Модель, Локация)
1. Пользователь вводит текст
2. Если длина >= 2 символа → поиск в БД
3. Если найдены совпадения → показываются кнопки
4. Если совпадений нет → текст принимается как есть
5. Пользователь может выбрать из списка или нажать "Ввести как есть"

### Автоматические кнопки (Статус, Филиал)
1. При входе в состояние автоматически показываются кнопки
2. Если пользователь вводит текст → снова показываются кнопки
3. Пользователь должен выбрать из списка

## Флаги в context.user_data

```python
# Флаги показа автоматических кнопок
'unfound_branch_shown'    # Филиалы показаны

# Временные данные для подсказок
'pending_unfound_employee_input'   # Введенное ФИО
'pending_unfound_type_input'       # Введенный тип
'pending_unfound_model_input'      # Введенная модель
'pending_unfound_location_input'   # Введенная локация

# Списки подсказок
'unfound_employee_suggestions'     # Список ФИО
'unfound_type_suggestions'         # Список типов
'unfound_model_suggestions'        # Список моделей
'unfound_location_suggestions'     # Список локаций
'unfound_status_suggestions'       # Список статусов
'unfound_branch_suggestions'       # Список филиалов

# Финальные значения
'unfound_employee'    # Выбранный сотрудник
'unfound_type'        # Выбранный тип
'unfound_model'       # Выбранная модель
'unfound_description' # Описание
'unfound_inventory'   # Инвентарный номер
'unfound_ip'          # IP-адрес
'unfound_location'    # Локация
'unfound_status'      # Статус
'unfound_branch'      # Филиал
```

## Callback Data

```
# ФИО
unfound_emp:0          # Выбор первого сотрудника
unfound_emp:manual     # Ввести как есть
unfound_emp:refresh    # Обновить список

# Тип
unfound_type:0         # Выбор первого типа
unfound_type:manual    # Ввести вручную

# Модель
unfound_model:0        # Выбор первой модели
unfound_model:manual   # Ввести как есть

# Локация
unfound_loc:0          # Выбор первой локации
unfound_loc:manual     # Ввести как есть

# Статус
unfound_status:0       # Выбор первого статуса
skip_status            # Пропустить

# Филиал
unfound_branch:0       # Выбор первого филиала
skip_branch            # Пропустить
```

## Отладка

### Проверка подсказок ФИО
```python
from bot.services.suggestions import get_employee_suggestions
suggestions = get_employee_suggestions("Иван", user_id)
print(suggestions)
```

### Проверка подсказок типов
```python
from bot.services.suggestions import get_equipment_type_suggestions
types = get_equipment_type_suggestions(user_id)
print(types)
```

### Проверка подсказок моделей
```python
from bot.services.suggestions import get_model_suggestions
models = get_model_suggestions("Dell", user_id)
print(models)
```

### Проверка подсказок локаций
```python
from bot.services.suggestions import get_location_suggestions
locations = get_location_suggestions("Офис", user_id)
print(locations)
```

### Проверка филиалов
```python
from bot.services.suggestions import get_branch_suggestions
branches = get_branch_suggestions(user_id)
print(branches)
```

## Частые проблемы

### Подсказки не показываются
- Проверьте подключение к БД
- Проверьте, что в БД есть данные
- Проверьте логи на ошибки
- Убедитесь, что введено минимум 2 символа

### Кнопки не работают
- Проверьте, что обработчики зарегистрированы в main.py
- Проверьте callback_data в логах
- Убедитесь, что бот перезапущен после изменений

### Автоматические кнопки не показываются
- Проверьте флаг в context.user_data
- Убедитесь, что функция show_*_suggestions вызывается
- Проверьте логи на ошибки

### Данные не сохраняются
- Проверьте, что все обязательные поля заполнены
- Убедитесь, что процесс дошёл до подтверждения
- Проверьте логи на ошибки сохранения

## Тестирование

### Быстрый тест всех подсказок
1. Запустите бота: `python -m bot.main`
2. Начните процесс добавления ненайденного
3. Проверьте каждое поле:
   - ✅ ФИО: введите 2+ символа → должны показаться кнопки
   - ✅ Тип: должны показаться кнопки автоматически
   - ✅ Модель: введите 2+ символа → должны показаться кнопки
   - ✅ Локация: введите 2+ символа → должны показаться кнопки
   - ✅ Статус: должны показаться кнопки автоматически
   - ✅ Филиал: должны показаться кнопки автоматически

### Проверка логов
```powershell
Get-Content bot.log -Tail 100 | Select-String "подсказ"
```

## Версия
**Документ:** v1.0  
**Дата:** 21 октября 2024  
**Версия бота:** 2.0.2
