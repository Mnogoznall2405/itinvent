# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–æ—Ç–∞

## 21.10.2024

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –ø–µ—Ä–µ–Ω–æ—Å–∞ —Å—Ç—Ä–æ–∫

**–ü—Ä–æ–±–ª–µ–º–∞:** –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–ª —Å–æ–æ–±—â–µ–Ω–∏—è —Å —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —Å–∏–º–≤–æ–ª–∞–º–∏ `\n` –≤–º–µ—Å—Ç–æ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–Ω–æ—Å–æ–≤ —Å—Ç—Ä–æ–∫.

**–†–µ—à–µ–Ω–∏–µ:** –ó–∞–º–µ–Ω–µ–Ω—ã –≤—Å–µ `\\n` –Ω–∞ `\n` –≤ —Å–ª–µ–¥—É—é—â–∏—Ö —Ñ–∞–π–ª–∞—Ö:
- `bot/handlers/transfer.py` - 10 –º–µ—Å—Ç
- `bot/handlers/export.py` - 5 –º–µ—Å—Ç
- `bot/handlers/database.py` - 5 –º–µ—Å—Ç
- `bot/handlers/employee.py` - 3 –º–µ—Å—Ç–∞

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ /done –ø—Ä–∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∫–æ–º–∞–Ω–¥—ã `/done` –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –Ω–∏—á–µ–≥–æ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ.

**–ü—Ä–∏—á–∏–Ω–∞:** –í `ConversationHandler` –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è `TRANSFER_WAIT_PHOTOS` –±—ã–ª —Ñ–∏–ª—å—Ç—Ä `filters.TEXT & ~filters.COMMAND`, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–∫–ª—é—á–∞–ª –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã, –≤–∫–ª—é—á–∞—è `/done`.

**–†–µ—à–µ–Ω–∏–µ:**
1. –î–æ–±–∞–≤–ª–µ–Ω –æ—Ç–¥–µ–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `CommandHandler("done", receive_transfer_photos)` –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ `TRANSFER_WAIT_PHOTOS` –≤ `bot/main.py`
2. –û–±–Ω–æ–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –≤ `receive_transfer_photos` –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–º–∞–Ω–¥—ã `/done`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `bot/main.py`:**
```python
States.TRANSFER_WAIT_PHOTOS: [
    CommandHandler("done", receive_transfer_photos),  # –î–æ–±–∞–≤–ª–µ–Ω–æ
    MessageHandler(filters.PHOTO, receive_transfer_photos),
    MessageHandler(filters.TEXT & ~filters.COMMAND, receive_transfer_photos)
],
```

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `bot/handlers/transfer.py`:**
- –û–±–Ω–æ–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–∞–Ω–¥—ã `/done` —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `startswith('/done')`
- –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∞–≤—Ç–æ–ø–æ–¥—Å–∫–∞–∑–∫–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –≤–≤–æ–¥–µ –§–ò–û —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –Ω–µ –±—ã–ª–æ –∞–≤—Ç–æ–ø–æ–¥—Å–∫–∞–∑–æ–∫ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.

**–†–µ—à–µ–Ω–∏–µ:**
1. –°–æ–∑–¥–∞–Ω —Å–µ—Ä–≤–∏—Å `bot/services/suggestions.py` —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏:
   - `get_employee_suggestions()` - –ø–æ–∏—Å–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –ø–æ –ø–æ–¥—Å—Ç—Ä–æ–∫–µ
   - `get_model_suggestions()` - –ø–æ–∏—Å–∫ –º–æ–¥–µ–ª–µ–π –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è
2. –î–æ–±–∞–≤–ª–µ–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏ –≤ `bot/utils/keyboards.py`:
   - `create_employee_suggestions_keyboard()` - –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å –§–ò–û
   - `create_model_suggestions_keyboard()` - –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å –º–æ–¥–µ–ª—è–º–∏
3. –û–±–Ω–æ–≤–ª–µ–Ω `bot/handlers/transfer.py`:
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª–∏–Ω—ã –≤–≤–æ–¥–∞ (–º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞)
   - –ü–æ–∫–∞–∑ –ø–æ–¥—Å–∫–∞–∑–æ–∫ –ø—Ä–∏ –≤–≤–æ–¥–µ –§–ò–û
   - –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ –∏–∑ –ø–æ–¥—Å–∫–∞–∑–æ–∫
   - –ö–Ω–æ–ø–∫–∏ "–í–≤–µ—Å—Ç–∏ –∫–∞–∫ –µ—Å—Ç—å" –∏ "–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫"

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –ø—Ä–∏ –≤–≤–æ–¥–µ 2+ —Å–∏–º–≤–æ–ª–æ–≤
- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: —Å–Ω–∞—á–∞–ª–∞ –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å –≤–≤–µ–¥—ë–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞, –∑–∞—Ç–µ–º —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ –µ–≥–æ
- Fallback –Ω–∞ —Ç–∞–±–ª–∏—Ü—É OWNERS –µ—Å–ª–∏ –≤ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–¥—Å–∫–∞–∑–æ–∫
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–≤–µ—Å—Ç–∏ –§–ò–û –≤—Ä—É—á–Ω—É—é

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö –≤ PDF-–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–µ

**–ü—Ä–æ–±–ª–µ–º–∞:** –û—à–∏–±–∫–∞ `'float' object is not iterable` –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ PDF-–∞–∫—Ç–∞.

**–ü—Ä–∏—á–∏–Ω–∞:** –ò–Ω–≤–µ–Ω—Ç–∞—Ä–Ω—ã–µ –Ω–æ–º–µ—Ä–∞ –∏ –¥—Ä—É–≥–∏–µ –ø–æ–ª—è –∏–∑ –ë–î –º–æ–≥—É—Ç –±—ã—Ç—å —á–∏—Å–ª–∞–º–∏ (float/int), –∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ `python-docx` –æ–∂–∏–¥–∞–µ—Ç —Å—Ç—Ä–æ–∫–∏.

**–†–µ—à–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤—Å–µ—Ö –∑–Ω–∞—á–µ–Ω–∏–π –≤ —Å—Ç—Ä–æ–∫–∏ —á–µ—Ä–µ–∑ `str()`
- –û–±—Ä–∞–±–æ—Ç–∫–∞ `None` –∏ –ø—É—Å—Ç—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ –ø–µ—Ä–µ–¥ –∑–∞–ø–∏—Å—å—é –≤ —è—á–µ–π–∫–∏ —Ç–∞–±–ª–∏—Ü—ã

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è PDF-–∞–∫—Ç–æ–≤ –ø—Ä–∏–µ–º–∞-–ø–µ—Ä–µ–¥–∞—á–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** –§—É–Ω–∫—Ü–∏—è `generate_transfer_act` –±—ã–ª–∞ –∑–∞–≥–ª—É—à–∫–æ–π –∏ –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª–∞ PDF.

**–†–µ—à–µ–Ω–∏–µ:**
1. –°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å `bot/services/pdf_generator.py` —Å —Ñ—É–Ω–∫—Ü–∏–µ–π `generate_transfer_act_pdf`
2. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è DOCX-–¥–æ–∫—É–º–µ–Ω—Ç–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `python-docx`
3. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è DOCX –≤ PDF —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `docx2pdf`
4. –î–æ–±–∞–≤–ª–µ–Ω–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ `python-docx>=0.8.11` –≤ `requirements.txt`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- –°–æ–∑–¥–∞–Ω–∏–µ –∞–∫—Ç–∞ —Å —Ç–∞–±–ª–∏—Ü–µ–π –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (—Å–µ—Ä–∏–π–Ω—ã–µ –Ω–æ–º–µ—Ä–∞, –º–æ–¥–µ–ª–∏, —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏)
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ –Ω–æ–º–µ—Ä–∞ –∞–∫—Ç–∞ –ø–æ –¥–∞—Ç–µ –∏ –≤—Ä–µ–º–µ–Ω–∏
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `transfer_acts/`
- Fallback –Ω–∞ DOCX –µ—Å–ª–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ PDF –Ω–µ —É–¥–∞–ª–∞—Å—å

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∞–∫—Ç–∞:**
- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å –Ω–æ–º–µ—Ä–æ–º –∏ –¥–∞—Ç–æ–π
- –¢–∞–±–ª–∏—Ü–∞ —Å –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ–º (‚Ññ, –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ, –°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä, –ò–Ω–≤–µ–Ω—Ç–∞—Ä–Ω—ã–π ‚Ññ, –û—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞)
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–µ—Ä–µ–¥–∞—á–µ (–û—Ç –∫–æ–≥–æ / –ö –∫–æ–º—É)
- –¢–∞–±–ª–∏—Ü–∞ –ø–æ–¥–ø–∏—Å–µ–π (–°–¥–∞–ª / –ü—Ä–∏–Ω—è–ª)
- –î–∞—Ç–∞ —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:

1. **–ü–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫:**
   - –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ª—é–±—É—é –∫–æ–º–∞–Ω–¥—É –±–æ—Ç–∞
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–µ—Ä–µ–Ω–æ—Å–∞–º–∏ —Å—Ç—Ä–æ–∫

2. **–ö–æ–º–∞–Ω–¥–∞ /done:**
   - –í—ã–±–µ—Ä–∏—Ç–µ "üì¶ –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è —Å –∞–∫—Ç–æ–º"
   - –û—Ç–ø—Ä–∞–≤—å—Ç–µ –æ–¥–Ω—É –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
   - –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/done`
   - –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –∑–∞–ø—Ä–æ—Å–∏—Ç—å –§–ò–û –Ω–æ–≤–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞

3. **–ê–≤—Ç–æ–ø–æ–¥—Å–∫–∞–∑–∫–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤:**
   - –í—ã–±–µ—Ä–∏—Ç–µ "üì¶ –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è —Å –∞–∫—Ç–æ–º"
   - –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ `/done`
   - –ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –§–ò–û (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ò–≤–∞–Ω")
   - –î–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –∫–Ω–æ–ø–∫–∏ —Å —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è–º–∏
   - –í—ã–±–µ—Ä–∏—Ç–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –∏–∑ —Å–ø–∏—Å–∫–∞ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ "–í–≤–µ—Å—Ç–∏ –∫–∞–∫ –µ—Å—Ç—å"

4. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF-–∞–∫—Ç–∞:**
   - –í—ã–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è
   - –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ
   - –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –æ—Ç–ø—Ä–∞–≤–∏—Ç—å PDF-—Ñ–∞–π–ª —Å –∞–∫—Ç–æ–º –ø—Ä–∏–µ–º–∞-–ø–µ—Ä–µ–¥–∞—á–∏
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ PDF (–≤—Å–µ –¥–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω—ã)

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

–ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –±–æ—Ç–∞ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–æ–≤—É—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å:

```bash
pip install python-docx>=0.8.11
```

–ò–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

```bash
pip install -r requirements.txt
```
