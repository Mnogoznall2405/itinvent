# Hotfix: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è callback –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å—Ç–∞—Ä—ã–º –≤–ª–∞–¥–µ–ª—å—Ü–∞–º

## –î–∞—Ç–∞: 22.10.2024

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ "üìß –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å—Ç–∞—Ä—ã–º –≤–ª–∞–¥–µ–ª—å—Ü–∞–º" –Ω–∏—á–µ–≥–æ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ.

## –ü—Ä–∏—á–∏–Ω–∞

Callback `act:email_owners` –Ω–µ –±—ã–ª –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ `bot/main.py`.

–í pattern —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª `email_owners`:

```python
# –ë—ã–ª–æ:
pattern=r'^act:(email|email_input|email_owner|skip)$'

# –ù–µ —Ö–≤–∞—Ç–∞–ª–æ: email_owners
```

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### –§–∞–π–ª: `bot/main.py` (—Å—Ç—Ä–æ–∫–∞ ~388)

```python
# –ë—ã–ª–æ:
application.add_handler(CallbackQueryHandler(
    handle_act_action_callback, 
    pattern=r'^act:(email|email_input|email_owner|skip)$'
))

# –°—Ç–∞–ª–æ:
application.add_handler(CallbackQueryHandler(
    handle_act_action_callback, 
    pattern=r'^act:(email|email_input|email_owner|email_owners|skip)$'
))
```

## –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å

### 1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞

```powershell
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ç–µ–∫—É—â–∏–π –ø—Ä–æ—Ü–µ—Å—Å (Ctrl+C)
# –ó–∞—Ç–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç–µ –∑–∞–Ω–æ–≤–æ
.\start_bot.bat
```

### 2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Ç–µ—Å—Ç

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ `/transfer`
2. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è
3. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/done`
4. –í–≤–µ–¥–∏—Ç–µ –§–ò–û –Ω–æ–≤–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
5. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ
6. **–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "üìß –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å—Ç–∞—Ä—ã–º –≤–ª–∞–¥–µ–ª—å—Ü–∞–º"**

### 3. –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–î–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ:
```
üìß –û—Ç–ø—Ä–∞–≤–∫–∞ –∞–∫—Ç–æ–≤ —Å—Ç–∞—Ä—ã–º –≤–ª–∞–¥–µ–ª—å—Ü–∞–º...
```

–ó–∞—Ç–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏:
```
‚úÖ –í—Å–µ –∞–∫—Ç—ã —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã!

üìß –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –∞–∫—Ç–æ–≤: 2

–ü–æ–ª—É—á–∞—Ç–µ–ª–∏:
  ‚Ä¢ –ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á ‚Üí ivanov@company.com
  ‚Ä¢ –ü–µ—Ç—Ä–æ–≤ –ü–µ—Ç—Ä –ü–µ—Ç—Ä–æ–≤–∏—á ‚Üí petrov@company.com
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:

```powershell
# –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ª–æ–≥–∏
Get-Content bot.log -Tail 50

# –ü–æ–∏—Å–∫ callback
Select-String -Path bot.log -Pattern "\[ACT_EMAIL\] –ü–æ–ª—É—á–µ–Ω callback" -Context 2

# –ü–æ–∏—Å–∫ –æ—à–∏–±–æ–∫
Select-String -Path bot.log -Pattern "ERROR|Exception" -Context 3 | Select-Object -Last 10
```

## –û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏

–ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –ª–æ–≥–∏:

```
[ACT_EMAIL] –ü–æ–ª—É—á–µ–Ω callback: act:email_owners
[ACT_EMAIL] User ID: 123456789
Email –Ω–µ –Ω–∞–π–¥–µ–Ω –¥–ª—è –ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á  # –ï—Å–ª–∏ email –Ω–µ –≤ –ë–î
–ê–∫—Ç —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –ü–µ—Ç—Ä–æ–≤ –ü–µ—Ç—Ä –ü–µ—Ç—Ä–æ–≤–∏—á –Ω–∞ petrov@company.com  # –ï—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ
```

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞ 1: Callback –≤—Å–µ –µ—â–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±–æ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ main.py —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫ –∏–º–ø–æ—Ä—Ç–∞

### –ü—Ä–æ–±–ª–µ–º–∞ 2: Email –Ω–µ –Ω–∞–π–¥–µ–Ω –¥–ª—è –≤—Å–µ—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ email –≤ —Ç–∞–±–ª–∏—Ü–µ OWNERS:
   ```sql
   SELECT OWNER_DISPLAY_NAME, OWNER_EMAIL 
   FROM OWNERS 
   WHERE OWNER_DISPLAY_NAME LIKE '%–ò–≤–∞–Ω–æ–≤%'
   ```
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É "‚úâÔ∏è –í–≤–µ—Å—Ç–∏ email –≤—Ä—É—á–Ω—É—é" –∫–∞–∫ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—É

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ email

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å SMTP-—Å–µ—Ä–≤–µ—Ä–∞
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ .env:
   ```bash
   SMTP_SERVER=10.103.0.51
   SMTP_PORT=25
   EMAIL_ADDRESS=noreply@company.com
   ```

## –°—Ç–∞—Ç—É—Å

- [x] –ò—Å–ø—Ä–∞–≤–ª–µ–Ω pattern –≤ main.py
- [x] –î–æ–±–∞–≤–ª–µ–Ω `email_owners` –≤ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
- [ ] –¢—Ä–µ–±—É–µ—Ç—Å—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞
- [ ] –¢—Ä–µ–±—É–µ—Ç—Å—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

## –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- `docs/FEATURE_EMAIL_TO_OLD_OWNERS.md` - –û–ø–∏—Å–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
- `docs/QUICK_START_EMAIL_OWNERS.md` - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
- `docs/HOTFIX_TRANSFER_EMAIL_SUGGESTIONS.md` - –ü—Ä–µ–¥—ã–¥—É—â–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
